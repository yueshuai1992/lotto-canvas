"use strict";Object.defineProperty(exports,"__esModule",{value:!0});class t{constructor(){this.htmlFontSize=16,this.dpr=1,this.setDpr(),this.setHTMLFontSize(),this.resetArrayPropo()}setDpr(){window.dpr=this.dpr=1.3*(window.devicePixelRatio||2)}setHTMLFontSize(){this.htmlFontSize=+getComputedStyle(document.documentElement).fontSize.slice(0,-2)}optimizeClarity(t,e,i){const{dpr:s}=this,n=t=>(t*s-t)/(t*s)*(s/2)*100;t.style.transform=`scale(${1/s}) translate(\n      ${-n(e)}%, ${-n(i)}%\n    )`}changeUnits(t,{denominator:e=1,clean:i=!1}){return Number(t.replace(/^(\-*[0-9.]*)([a-z%]*)$/,(t,s,n)=>{switch(n){case"%":s*=e/100;break;case"px":s*=1;break;case"rem":s*=this.htmlFontSize;break;default:s*=1}return i||"%"===n?s:s*this.dpr}))}update(){}resetArrayPropo(){const t=this,e=Array.prototype,i=Object.create(e);["push","pop","shift","unshift","sort","splice","reverse"].forEach(s=>{i[s]=function(){t.update(),console.log(s,"触发了 set"),e[s].call(this,...arguments)}})}observer(t,e=[]){"object"==typeof t&&null!==t&&(e.length?e:Object.keys(t)).forEach(e=>{this.defineReactive(t,e,t[e])})}defineReactive(t,e,i){const s=this;s.observer(i),Object.defineProperty(t,e,{get:()=>i,set(t){t!==i&&(i=t,s.observer(i),console.log(e,"触发了 set"),s.update())}})}}const e=(t,...e)=>e.some(e=>Object.prototype.toString.call(t).slice(8,-1).toLowerCase()===e),i=t=>[].filter.call(t,t=>"\n"!==t).join(""),s=t=>Math.PI/180*t,n=(t,e)=>[+(Math.cos(t)*e).toFixed(8),+(Math.sin(t)*e).toFixed(8)],o=(t,e)=>{const i=-t/e;return[i,-i*t+e]},r=(t,e,i,a,h=!0)=>{if(Math.abs(a-i).toFixed(8)>=s(180).toFixed(8)){const s=(a+i)/2;return h?(r(t,e,i,s,h),r(t,e,s,a,h)):(r(t,e,s,a,h),r(t,e,i,s,h)),!1}h||([i,a]=[a,i]);const[l,d]=n(i,e),[c,u]=n(a,e),[g,p]=o(l,d),[f,m]=o(c,u);let b=(m-p)/(g-f),y=(f*p-g*m)/(f-g);isNaN(b)&&(Math.abs(l)===+e.toFixed(8)&&(b=l),Math.abs(c)===+e.toFixed(8)&&(b=c)),g===1/0||g===-1/0?y=f*b+m:f!==1/0&&f!==-1/0||(y=g*b+p),t.lineTo(l,d),t.arcTo(b,y,c,u,e)},a=(t,e,i,s,n,o,r)=>{const a=Math.min(s,n);o>a/2&&(o=a/2),t.beginPath(),t.fillStyle=r,t.moveTo(e+o,i),t.lineTo(e+o,i),t.lineTo(e+s-o,i),t.arcTo(e+s,i,e+s,i+o,o),t.lineTo(e+s,i+n-o),t.arcTo(e+s,i+n,e+s-o,i+n,o),t.lineTo(e+o,i+n),t.arcTo(e,i+n,e,i+n-o,o),t.lineTo(e,i+o),t.arcTo(e,i,e+o,i,o),t.closePath(),t.fill()},h=function(t,e,i,s){return t>=s&&(t=s),i*(t/=s)*t+e},l=function(t,e,i,s){return t>=s&&(t=s),-i*(t/=s)*(t-2)+e};class d extends t{constructor(t,e={}){super(),this.blocks=[],this.prizes=[],this.buttons=[],this.defaultConfig={gutter:"0px",offsetDegree:0,speed:20,accelerationTime:2500,decelerationTime:2500},this.defaultStyle={fontSize:"18px",fontColor:"#000",fontStyle:"microsoft yahei ui,microsoft yahei,simsun,sans-serif",fontWeight:"400",background:"#fff",wordWrap:!0,lengthLimit:"90%"},this.Radius=0,this.prizeRadius=0,this.prizeDeg=0,this.prizeRadian=0,this.rotateDeg=0,this.maxBtnRadius=0,this.startTime=0,this.endTime=0,this.stopDeg=0,this.endDeg=0,this.animationId=0,this.FPS=16.6,this.prizeImgs=[[]],this.btnImgs=[[]],this.box=t,this.canvas=document.createElement("canvas"),this.box.appendChild(this.canvas),this.ctx=this.canvas.getContext("2d"),this.setData(e);let i=[[]];this.prizes&&(i=this.prizes.map(t=>t.imgs)),this.buttons&&i.push(...this.buttons.map(t=>t.imgs)),this.init(i)}setData(t){this.blocks=t.blocks||[],this.prizes=t.prizes||[],this.buttons=t.buttons||[],this.startCallback=t.start,this.endCallback=t.end;for(const e in t.defaultConfig)this.defaultConfig[e]=t.defaultConfig[e];for(const e in t.defaultStyle)this.defaultStyle[e]=t.defaultStyle[e]}init(t){this.setDpr(),this.setHTMLFontSize();const{box:i,canvas:s,ctx:n,dpr:o}=this;if(!i)return;s.width=s.height=i.offsetWidth*o,this.Radius=s.width/2,this.optimizeClarity(s,2*this.Radius,2*this.Radius),n.translate(this.Radius,this.Radius);const r=()=>{this.draw(),s.onclick=t=>{n.beginPath(),n.arc(0,0,this.maxBtnRadius,0,2*Math.PI,!1),n.isPointInPath(t.offsetX,t.offsetY)&&(this.startTime||this.startCallback(t))}};let a=0,h=0;e(t,"array")&&(this.draw(),t.forEach((t,e)=>{if(!t)return!1;t.forEach((t,i)=>{h++,this.loadAndCacheImg(e,i,()=>{a++,h===a&&r.call(this)})})})),h||r.call(this)}loadAndCacheImg(t,e,i){const s=t<this.prizes.length,n=s?"prizes":"buttons",o=s?"prizeImgs":"btnImgs";t=s?t:t-this.prizes.length;const r=this[n][t];if(!r||!r.imgs)return;const a=r.imgs[e];if(!a)return;const h=new Image;this[o][t]||(this[o][t]=[]),this[o][t][e]=h,h.src=a.src,h.onload=()=>i.call(this)}computedWidthAndHeight(t,e,i,s){if(!e.width&&!e.height)return[t.width,t.height];if(e.width&&!e.height){const s=this.getWidth(e.width,i);return[s,t.height*(s/t.width)]}if(!e.width&&e.height){const i=this.getHeight(e.height,s);return[t.width*(i/t.height),i]}return[this.getWidth(e.width,i),this.getHeight(e.height,s)]}draw(){const{ctx:t,dpr:e,defaultConfig:o,defaultStyle:a}=this;t.clearRect(-this.Radius,-this.Radius,2*this.Radius,2*this.Radius),this.prizeRadius=this.blocks.reduce((i,s)=>(t.beginPath(),t.fillStyle=s.background,t.arc(0,0,i,0,2*Math.PI,!1),t.fill(),i-this.getLength(s.padding.split(" ")[0])*e),this.Radius),this.prizeDeg=360/this.prizes.length,this.prizeRadian=s(this.prizeDeg);const h=s(-90+this.rotateDeg+o.offsetDegree),l=e=>this.getOffsetX(t.measureText(e).width),d=(t,i,s)=>{const n=t.lineHeight||a.lineHeight||t.fontSize||a.fontSize;return this.getHeight(t.top,i)+(s+1)*this.getLength(n)*e};t.save(),this.prizes.forEach((c,u)=>{const g=h+u*this.prizeRadian,p=this.prizeRadius-this.maxBtnRadius;((t,e,i,o,a,h,l)=>{e||(e=h);const d=s(90/Math.PI/i*h),c=s(90/Math.PI/e*h),u=o+d,g=a-d,p=o+c,f=a-c;t.beginPath(),t.fillStyle=l,t.moveTo(...n(u,i)),r(t,i,u,g,!0),f>p?r(t,e,p,f,!1):t.lineTo(...n((o+a)/2,h/2/Math.abs(Math.sin((o-a)/2)))),t.closePath(),t.fill()})(t,this.maxBtnRadius,this.prizeRadius,g-this.prizeRadian/2,g+this.prizeRadian/2,this.getLength(o.gutter)*e,c.background||a.background||"rgba(0, 0, 0, 0)");const f=Math.cos(g)*this.prizeRadius,m=Math.sin(g)*this.prizeRadius;t.translate(f,m),t.rotate(g+s(90)),c.imgs&&c.imgs.forEach((e,i)=>{if(!this.prizeImgs[u])return;const s=this.prizeImgs[u][i];if(!s)return;const[n,o]=this.computedWidthAndHeight(s,e,this.prizeRadian*this.prizeRadius,p);t.drawImage(s,this.getOffsetX(n),this.getHeight(e.top,p),n,o)}),c.fonts&&c.fonts.forEach(s=>{const n=s.fontColor||a.fontColor,r=s.fontWeight||a.fontWeight,h=this.getLength(s.fontSize||a.fontSize),c=s.fontStyle||a.fontStyle;t.fillStyle=n,t.font=`${r} ${h*e}px ${c}`;let u=[],g=String(s.text);if(Object.prototype.hasOwnProperty.call(s,"wordWrap")?s.wordWrap:a.wordWrap){g=i(g);let n="";for(let i=0;i<g.length;i++){n+=g[i];const r=t.measureText(n).width,h=(this.prizeRadius-d(s,p,u.length))*Math.tan(this.prizeRadian/2)*2-this.getLength(o.gutter)*e;r>this.getWidth(s.lengthLimit||a.lengthLimit,h)&&(u.push(n.slice(0,-1)),n=g[i])}n&&u.push(n),u.length||u.push(g)}else u=g.split("\n");u.filter(t=>!!t).forEach((e,i)=>{t.fillText(e,l(e),d(s,p,i))})}),t.rotate(s(360)-g-s(90)),t.translate(-f,-m)}),t.restore(),this.buttons.forEach((i,s)=>{const n=this.getHeight(i.radius);this.maxBtnRadius=Math.max(this.maxBtnRadius,n),t.beginPath(),t.fillStyle=i.background||"rgba(0, 0, 0, 0)",t.arc(0,0,n,0,2*Math.PI,!1),t.fill(),i.pointer&&(t.beginPath(),t.fillStyle=i.background||"rgba(0, 0, 0, 0)",t.moveTo(-n,0),t.lineTo(n,0),t.lineTo(0,2*-n),t.closePath(),t.fill()),i.imgs&&i.imgs.forEach((e,o)=>{if(!this.btnImgs[s])return;const r=this.btnImgs[s][o];if(!r)return;const[a,h]=this.computedWidthAndHeight(r,e,2*this.getHeight(i.radius),2*this.getHeight(i.radius));t.drawImage(r,this.getOffsetX(a),this.getHeight(e.top,n),a,h)}),i.fonts&&i.fonts.forEach(i=>{const s=i.fontColor||a.fontColor,o=i.fontWeight||a.fontWeight,r=this.getLength(i.fontSize||a.fontSize),h=i.fontStyle||a.fontStyle;t.fillStyle=s,t.font=`${o} ${r*e}px ${h}`,String(i.text).split("\n").forEach((e,s)=>{t.fillText(e,l(e),d(i,n,s))})})})}play(){this.startTime||(cancelAnimationFrame(this.animationId),this.startTime=Date.now(),this.prizeFlag=void 0,this.run())}stop(t){this.prizeFlag=Number(t)%this.prizes.length}run(t=0){const{prizeFlag:e,prizeDeg:i,rotateDeg:s,defaultConfig:n}=this,o=Date.now()-this.startTime;if(o>=n.accelerationTime&&void 0!==e)return this.FPS=o/t,this.endTime=Date.now(),this.stopDeg=s,this.endDeg=1800-e*i-s-n.offsetDegree,cancelAnimationFrame(this.animationId),this.slowDown();this.rotateDeg=(s+h(o,0,n.speed,n.accelerationTime))%360,this.draw(),this.animationId=window.requestAnimationFrame(this.run.bind(this,t+1))}slowDown(){const{prizes:t,prizeFlag:e,stopDeg:i,endDeg:s,defaultConfig:n}=this,o=Date.now()-this.endTime;if(o>=n.decelerationTime)return this.startTime=0,this.endCallback({...t.find((t,i)=>i===e)}),cancelAnimationFrame(this.animationId);this.rotateDeg=l(o,i,s,n.decelerationTime)%360,this.draw(),this.animationId=window.requestAnimationFrame(this.slowDown.bind(this))}getLength(t){return e(t,"number")?t:e(t,"string")?this.changeUnits(t,{clean:!0}):0}getWidth(t,i=this.prizeRadian*this.prizeRadius){return e(t,"number")?t*this.dpr:e(t,"string")?this.changeUnits(t,{denominator:i}):0}getHeight(t,i=this.prizeRadius){return e(t,"number")?t*this.dpr:e(t,"string")?this.changeUnits(t,{denominator:i}):0}getOffsetX(t){return-t/2}}class c extends t{constructor(t,e={}){super(),this.rows=3,this.cols=3,this.blocks=[],this.prizes=[],this.defaultConfig={gutter:5,speed:20,accelerationTime:2500,decelerationTime:2500},this.defaultStyle={borderRadius:20,fontColor:"#000",fontSize:"18px",fontStyle:"microsoft yahei ui,microsoft yahei,simsun,sans-serif",fontWeight:"400",background:"#fff",shadow:"",wordWrap:!0,lengthLimit:"90%"},this.activeStyle={background:"#ffce98",shadow:""},this.boxWidth=0,this.boxHeight=0,this.cellWidth=0,this.cellHeight=0,this.startTime=0,this.endTime=0,this.currIndex=0,this.stopIndex=0,this.endIndex=0,this.demo=!1,this.timer=0,this.animationId=0,this.FPS=16.6,this.cells=[],this.cellImgs=[],this.blockData=[],this.box=t,this.canvas=document.createElement("canvas"),this.box.appendChild(this.canvas),this.ctx=this.canvas.getContext("2d"),this.setData(e);let i=[[]];this.prizes&&(i=this.prizes.map(t=>t.imgs)),this.button&&(i[this.cols*this.rows-1]=this.button.imgs),this.init(i)}setData(t){this.rows=Number(t.rows)||3,this.cols=Number(t.cols)||3,this.blocks=t.blocks||[],this.prizes=t.prizes||[],this.button=t.button,this.startCallback=t.start,this.endCallback=t.end;const e=this.defaultConfig,i=this.defaultStyle,s=this.activeStyle;for(const i in t.defaultConfig)e[i]=t.defaultConfig[i];e.gutter=this.getLength(e.gutter)*this.dpr,e.speed/=40;for(const e in t.defaultStyle)i[e]=t.defaultStyle[e];i.borderRadius=this.getLength(i.borderRadius)*this.dpr;for(const e in t.activeStyle)s[e]=t.activeStyle[e];this.observer(this,["rows","cols","blocks","prizes","button","defaultConfig","defaultStyle","startCallback","endCallback"])}init(t){this.setDpr(),this.setHTMLFontSize();const{box:i,canvas:s,dpr:n,defaultConfig:o}=this;if(!i)return;this.boxWidth=s.width=i.offsetWidth*n,this.boxHeight=s.height=i.offsetHeight*n,this.optimizeClarity(s,this.boxWidth,this.boxHeight),this.cells=[...this.prizes],this.button&&(this.cells[this.cols*this.rows-1]={...this.button}),this.cells.forEach(t=>{t.col=t.col||1,t.row=t.row||1}),this.blockData=[],this.prizeArea=this.blocks.reduce(({x:t,y:i,w:s,h:o},r)=>{const[a,h,l,d]=(t=>{const i=t.padding.replace(/px/g,"").split(" ").map(t=>~~t)||[0];let s=0,n=0,o=0,r=0;switch(i.length){case 1:s=n=o=r=i[0];break;case 2:s=n=i[0],o=r=i[1];break;case 3:s=i[0],o=r=i[1],n=i[2];break;default:s=i[0],n=i[1],o=i[2],r=i[3]}const a={paddingTop:s,paddingBottom:n,paddingLeft:o,paddingRight:r};for(const i in a)a[i]=Object.prototype.hasOwnProperty.call(t,i)&&e(t[i],"string","number")?~~String(t[i]).replace(/px/g,""):a[i];return[s,n,o,r]})(r).map(t=>t*n);return this.blockData.push([t,i,s,o,r.borderRadius?this.getLength(r.borderRadius)*n:0,r.background]),{x:t+l,y:i+a,w:s-l-d,h:o-a-h}},{x:0,y:0,w:this.boxWidth,h:this.boxHeight}),this.cellWidth=(this.prizeArea.w-o.gutter*(this.cols-1))/this.cols,this.cellHeight=(this.prizeArea.h-o.gutter*(this.rows-1))/this.rows;const r=()=>{this.draw(),this.demo&&this.walk(),this.button&&(s.onclick=t=>{const[e,i,s,n]=this.getGeometricProperty([this.button.x,this.button.y,this.button.col||1,this.button.row||1]);if(t.offsetX<e||t.offsetY<i||t.offsetX>e+s||t.offsetY>i+n)return!1;this.startTime||this.startCallback(t)})};let a=0,h=0;e(t,"array")&&(this.draw(),t.forEach((t,e)=>{if(!t)return!1;t.forEach((t,i)=>{h++,this.loadAndCacheImg(e,i,()=>{a++,h===a&&r.call(this)})})})),h||r.call(this)}loadAndCacheImg(t,e,i){const s=this.cells[t];if(!s||!s.imgs)return;const n=s.imgs[e];this.cellImgs[t]||(this.cellImgs[t]=[]);const o=new Image;this.cellImgs[t][e]={defaultImg:o},o.src=n.src;let r=0,a=1;if(o.onload=()=>{r++,r===a&&i.call(this)},!Object.prototype.hasOwnProperty.call(n,"activeSrc"))return;a++;const h=new Image;this.cellImgs[t][e].activeImg=h,h.src=n.activeSrc,h.onload=()=>{r++,r===a&&i.call(this)}}computedWidthAndHeight(t,e,i){if(!e.width&&!e.height)return[t.width,t.height];if(e.width&&!e.height){const s=this.getWidth(e.width,i.col);return[s,t.height*(s/t.width)]}if(!e.width&&e.height){const s=this.getHeight(e.height,i.row);return[t.width*(s/t.height),s]}return[this.getWidth(e.width,i.col),this.getHeight(e.height,i.row)]}draw(){const{ctx:t,dpr:e,defaultStyle:s,activeStyle:n}=this;t.clearRect(0,0,this.boxWidth,this.boxWidth),this.blockData.forEach(([e,i,s,n,o,r])=>{a(t,e,i,s,n,o,this.handleBackground(e,i,s,n,r))}),this.cells.forEach((o,r)=>{let[h,l,d,c]=this.getGeometricProperty([o.x,o.y,o.col,o.row]);const u=r===this.currIndex%this.prizes.length>>0,g=(u?n.shadow:o.shadow||s.shadow).replace(/px/g,"").split(",")[0].split(" ").map((t,i)=>i<3?Number(t)*e:t);4===g.length&&(t.shadowColor=g[3],t.shadowOffsetX=g[0],t.shadowOffsetY=g[1],t.shadowBlur=g[2],g[0]>0?d-=g[0]:(d+=g[0],h-=g[0]),g[1]>0?c-=g[1]:(c+=g[1],l-=g[1])),a(t,h,l,d,c,o.borderRadius?this.getLength(o.borderRadius)*e:this.getLength(s.borderRadius),this.handleBackground(h,l,d,c,o.background,u)),t.shadowColor="rgba(255, 255, 255, 0)",t.shadowOffsetX=0,t.shadowOffsetY=0,t.shadowBlur=0,o.imgs&&o.imgs.forEach((e,i)=>{if(!this.cellImgs[r])return!1;const s=this.cellImgs[r][i];if(!s)return!1;const n=u&&s.activeImg||s.defaultImg,[a,d]=this.computedWidthAndHeight(n,e,o);t.drawImage(n,h+this.getOffsetX(a,o.col),l+this.getHeight(e.top,o.row),a,d)}),o.fonts&&o.fonts.forEach(r=>{const a=u&&n.fontStyle?n.fontStyle:r.fontStyle||s.fontStyle,d=u&&n.fontWeight?n.fontWeight:r.fontWeight||s.fontWeight,c=u&&n.fontSize?this.getLength(n.fontSize):this.getLength(r.fontSize||s.fontSize),g=u&&n.lineHeight?n.lineHeight:r.lineHeight||s.lineHeight||r.fontSize||s.fontSize;t.font=`${d} ${c*e}px ${a}`,t.fillStyle=u&&n.fontColor?n.fontColor:r.fontColor||s.fontColor;let p=[],f=String(r.text);if(Object.prototype.hasOwnProperty.call(r,"wordWrap")?r.wordWrap:s.wordWrap){f=i(f);let e="";for(let i=0;i<f.length;i++){e+=f[i];t.measureText(e).width>this.getWidth(r.lengthLimit||s.lengthLimit,o.col)&&(p.push(e.slice(0,-1)),e=f[i])}e&&p.push(e),p.length||p.push(f)}else p=f.split("\n");p.forEach((i,s)=>{t.fillText(i,h+this.getOffsetX(t.measureText(i).width,o.col),l+this.getHeight(r.top,o.row)+(s+1)*this.getLength(g)*e)})})})}handleBackground(t,e,i,s,n,o=!1){const{ctx:r,defaultStyle:a,activeStyle:h}=this;return(n=o?h.background:n||a.background).includes("linear-gradient")&&(n=((t,e,i,s,n,o)=>{const r=/linear-gradient\((.+)\)/.exec(o)[1].split(",").map(t=>t.trim());let a=r.shift(),h=[0,0,0,0];if(a.includes("deg")){a=a.slice(0,-3)%360;const t=t=>Math.tan(t/180*Math.PI);a>=0&&a<45?h=[e,i+n,e+s,i+n-s*t(a-0)]:a>=45&&a<90?h=[e,i+n,e+s-n*t(a-45),i]:a>=90&&a<135?h=[e+s,i+n,e+s-n*t(a-90),i]:a>=135&&a<180?h=[e+s,i+n,e,i+s*t(a-135)]:a>=180&&a<225?h=[e+s,i,e,i+s*t(a-180)]:a>=225&&a<270?h=[e+s,i,e+n*t(a-225),i+n]:a>=270&&a<315?h=[e,i,e+n*t(a-270),i+n]:a>=315&&a<360&&(h=[e,i,e+s,i+n-s*t(a-315)])}else a.includes("top")?h=[e,i+n,e,i]:a.includes("bottom")?h=[e,i,e,i+n]:a.includes("left")?h=[e+s,i,e,i]:a.includes("right")&&(h=[e,i,e+s,i]);const l=t.createLinearGradient(...h.map(t=>t>>0));return r.reduce((t,e,i)=>{const s=e.split(" ");return 1===s.length?t.addColorStop(i,s[0]):2===s.length&&t.addColorStop(...s),t},l)})(r,t,e,i,s,n)),n}play(){this.startTime||(clearInterval(this.timer),cancelAnimationFrame(this.animationId),this.startTime=Date.now(),this.prizeFlag=void 0,this.run())}stop(t){this.prizeFlag=t%this.prizes.length}run(t=0){const{currIndex:e,prizes:i,prizeFlag:s,startTime:n,defaultConfig:o}=this,r=Date.now()-n;if(r>=o.accelerationTime&&void 0!==s)return this.FPS=r/t,this.endTime=Date.now(),this.stopIndex=e,this.endIndex=5*i.length+s-(e>>0),cancelAnimationFrame(this.animationId),this.slowDown();this.currIndex=(e+h(r,.1,o.speed,o.accelerationTime))%i.length,this.draw(),this.animationId=window.requestAnimationFrame(this.run.bind(this,t+1))}slowDown(){const{prizes:t,prizeFlag:e,stopIndex:i,endIndex:s,defaultConfig:n}=this,o=Date.now()-this.endTime;if(o>n.decelerationTime)return this.startTime=0,this.endCallback({...t.find((t,i)=>i===e)}),cancelAnimationFrame(this.animationId);this.currIndex=l(o,i,s,n.decelerationTime)%t.length,this.draw(),this.animationId=window.requestAnimationFrame(this.slowDown.bind(this))}walk(){clearInterval(this.timer),this.timer=window.setInterval(()=>{this.currIndex+=1,this.draw()},1300)}getGeometricProperty([t,e,i,s]){const{defaultConfig:n,cellWidth:o,cellHeight:r}=this,a=[this.prizeArea.x+(o+n.gutter)*t,this.prizeArea.y+(r+n.gutter)*e];return i&&s&&a.push(o*i+n.gutter*(i-1),r*s+n.gutter*(s-1)),a}getLength(t){return e(t,"number")?t:e(t,"string")?this.changeUnits(t,{clean:!0}):0}getWidth(t,i=1){return e(t,"number")?t*this.dpr:e(t,"string")?this.changeUnits(t,{denominator:this.cellWidth*i+this.defaultConfig.gutter*(i-1)}):0}getHeight(t,i=1){return e(t,"number")?t*this.dpr:e(t,"string")?this.changeUnits(t,{denominator:this.cellHeight*i+this.defaultConfig.gutter*(i-1)}):0}getOffsetX(t,e=1){return(this.cellWidth*e+this.defaultConfig.gutter*(e-1)-t)/2}}const u=(t,...e)=>e.some(e=>Object.prototype.toString.call(t).slice(8,-1).toLowerCase()===e),g=(t,e={},i="")=>(u(t,"object")&&(t=[t]),t.every((t,s)=>{for(const n in e){if(Object.prototype.hasOwnProperty.call(t,n),1===e[n]&&!Object.prototype.hasOwnProperty.call(t,n))return!!console.error(`参数 ${i}[${s}] 缺少 ${n} 属性`);if(u(e[n],"object")&&t[n]&&!g(t[n],e[n],i?`${i}[${s}].${n}`:n))return!1}return!0}));var p={props:{prizes:{type:Array,validator:t=>g({prizes:t},{prizes:{x:1,y:1,imgs:{src:1},fonts:{text:1}}}),default:()=>[]},button:{type:Object,validator:t=>g({button:[t]},{button:{x:1,y:1,imgs:{src:1},fonts:{text:1}}})},blocks:{type:Array,validator:t=>g({blocks:t},{blocks:{padding:1,background:1}}),default:()=>[]},defaultStyle:{type:Object,default:()=>({})},activeStyle:{type:Object,default:()=>({})},defaultConfig:{type:Object,default:()=>({})},cols:{type:[String,Number],default:3},rows:{type:[String,Number],default:3},demo:{type:Boolean,default:!1}},data:()=>({lucky:{prizes:[]}}),watch:{prizes:{handler(t){this.lucky.prizes=t},deep:!0},button:{handler(t){this.lucky.button=t},deep:!0}},mounted(){this.lucky=new c(this.$refs.lottoGrid,{...this.$props,start:(...t)=>{this.$emit("start",...t)},end:(...t)=>{this.$emit("end",...t)}})},methods:{play(...t){this.lucky.play(...t)},stop(...t){this.lucky.stop(...t)}}};function f(t,e,i,s,n,o,r,a,h,l){"boolean"!=typeof r&&(h=a,a=r,r=!1);const d="function"==typeof i?i.options:i;let c;if(t&&t.render&&(d.render=t.render,d.staticRenderFns=t.staticRenderFns,d._compiled=!0,n&&(d.functional=!0)),s&&(d._scopeId=s),o?(c=function(t){(t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),e&&e.call(this,h(t)),t&&t._registeredComponents&&t._registeredComponents.add(o)},d._ssrRegister=c):e&&(c=r?function(t){e.call(this,l(t,this.$root.$options.shadowRoot))}:function(t){e.call(this,a(t))}),c)if(d.functional){const t=d.render;d.render=function(e,i){return c.call(i),t(e,i)}}else{const t=d.beforeCreate;d.beforeCreate=t?[].concat(t,c):[c]}return i}const m="undefined"!=typeof navigator&&/msie [6-9]\\b/.test(navigator.userAgent.toLowerCase());function b(t){return(t,e)=>function(t,e){const i=m?e.media||"default":t,s=w[i]||(w[i]={ids:new Set,styles:[]});if(!s.ids.has(t)){s.ids.add(t);let i=e.source;if(e.map&&(i+="\n/*# sourceURL="+e.map.sources[0]+" */",i+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(e.map))))+" */"),s.element||(s.element=document.createElement("style"),s.element.type="text/css",e.media&&s.element.setAttribute("media",e.media),void 0===y&&(y=document.head||document.getElementsByTagName("head")[0]),y.appendChild(s.element)),"styleSheet"in s.element)s.styles.push(i),s.element.styleSheet.cssText=s.styles.filter(Boolean).join("\n");else{const t=s.ids.size-1,e=document.createTextNode(i),n=s.element.childNodes;n[t]&&s.element.removeChild(n[t]),n.length?s.element.insertBefore(e,n[t]):s.element.appendChild(e)}}}(t,e)}let y;const w={};const z=p;var x=function(){var t=this.$createElement;return(this._self._c||t)("div",{ref:"lottoGrid",staticClass:"lotto-grid"})};x._withStripped=!0;const S=f({render:x,staticRenderFns:[]},(function(t){t&&t("data-v-411ed542_0",{source:"\n.lotto-grid[data-v-411ed542] {\n  overflow: hidden;\n}\n",map:{version:3,sources:["/Users/yueshuai/Study/my-npm-package/lotto-canvas/src/LottoGrid.vue"],names:[],mappings:";AA8GA;EACA,gBAAA;AACA",file:"LottoGrid.vue",sourcesContent:["<template>\n  <div ref=\"lottoGrid\" class=\"lotto-grid\"></div>\n</template>\n\n<script>\nimport { LuckyGrid } from './lotto-cavans'\nimport { paramsValidator } from './utils/index.js'\nexport default {\n  props: {\n    // 奖品 (该属性被watch监听)\n    prizes: {\n      type: Array,\n      validator(data) {\n        return paramsValidator({ prizes: data }, {\n          prizes: { x: 1, y: 1, imgs: { src: 1 }, fonts: { text: 1 } }\n        })\n      },\n      default: () => []\n    },\n    // 按钮 (该属性被watch监听)\n    button: {\n      type: Object,\n      validator(data) {\n        return paramsValidator({ button: [data] }, {\n          button: { x: 1, y: 1, imgs: { src: 1 }, fonts: { text: 1 } }\n        })\n      }\n    },\n    // 边框 (该属性被watch监听)\n    blocks: {\n      type: Array,\n      validator(data) {\n        return paramsValidator({ blocks: data }, {\n          blocks: { padding: 1, background: 1 }\n        })\n      },\n      default: () => []\n    },\n    // 格子的默认样式 (该属性会在computed里面进行修正)\n    defaultStyle: {\n      type: Object,\n      default() { // 默认配置在computed里面: _defaultStyle\n        return {}\n      }\n    },\n    // 中奖标记样式 (该属性会在computed里面进行修正)\n    activeStyle: {\n      type: Object,\n      default() { // 默认配置在computed里面: _activeStyle\n        return {}\n      }\n    },\n    // 默认配置 (该属性会在computed里面进行修正)\n    defaultConfig: {\n      type: Object,\n      default: () => {\n        return {}\n      }\n    },\n    // 横向等分成 cols 个格子\n    cols: { type: [String, Number], default: 3 },\n    // 纵向等分成 rows 个格子\n    rows: { type: [String, Number], default: 3 },\n    // demo演示开启中奖标识自动游走\n    demo: { type: Boolean, default: false }\n  },\n  data() {\n    return {\n      lucky: {\n        prizes: []\n      }\n    }\n  },\n  watch: {\n    prizes: {\n      handler(newData) {\n        this.lucky.prizes = newData\n      },\n      deep: true\n    },\n    button: {\n      handler(newData) {\n        this.lucky.button = newData\n      },\n      deep: true\n    }\n  },\n  mounted() {\n    this.lucky = new LuckyGrid(this.$refs.lottoGrid, {\n      ...this.$props,\n      start: (...rest) => {\n        this.$emit('start', ...rest)\n      },\n      end: (...rest) => {\n        this.$emit('end', ...rest)\n      }\n    })\n  },\n  methods: {\n    play(...rest) {\n      this.lucky.play(...rest)\n    },\n    stop(...rest) {\n      this.lucky.stop(...rest)\n    }\n  }\n}\n<\/script>\n\n<style scoped>\n.lotto-grid {\n  overflow: hidden;\n}\n</style>\n"]},media:void 0})}),z,"data-v-411ed542",!1,void 0,!1,b,void 0,void 0);const v={props:{blocks:{type:Array,validator:t=>g({blocks:t},{blocks:{padding:1,background:1}}),default:()=>[]},prizes:{type:Array,validator:t=>g({prizes:t},{prizes:{fonts:{text:1},imgs:{src:1}}}),default:()=>[]},buttons:{type:Array,validator:t=>g({buttons:t},{buttons:{fonts:{text:1},imgs:{src:1}}}),default:()=>[]},defaultStyle:{type:Object,default:()=>({})},defaultConfig:{type:Object,default:()=>({})}},data:()=>({lucky:{prizes:[]}}),watch:{prizes:{handler(t){console.log(t),this.lucky.prizes=t},deep:!0},buttons:{handler(t){this.lucky.buttons=t},deep:!0}},mounted(){this.lucky=new d(this.$refs.luckDraw,{...this.$props,start:(...t)=>{this.$emit("start",...t)},end:(...t)=>{this.$emit("end",...t)}})},methods:{play(...t){this.lucky.play(...t)},stop(...t){this.lucky.stop(...t)}}};var k=function(){var t=this.$createElement;return(this._self._c||t)("div",{ref:"luckDraw"})};k._withStripped=!0;const C=f({render:k,staticRenderFns:[]},void 0,v,void 0,!1,void 0,!1,void 0,void 0,void 0),I=t=>{console.log(t),t.component("LuckyGrid",S),t.component("LuckyWheel",C)};"undefined"!=typeof window&&window.Vue&&I(window.Vue);var T={install:I};exports.LottoGrid=S,exports.LottoWheel=C,exports.default=T;
